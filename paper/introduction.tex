\section{Introduction}
Having seen hundreds of thousands of relays come and go over the last decade,
the Tor network is one of the largest volunteer-run anonymity networks.  To
implement onion routing, all these relays maintain several RSA key pairs---most
importantly a medium-term key that rotates occasionally, and a long-term key
that ideally never changes.  Most relays run The Tor Project's reference
C implementation on a standard Linux system, but some run third-party
implementations, or on constrained systems such as Raspberry Pis, raising the
question if these machines managed to generate safe keys upon bootstrapping.
Past work investigated this question for TLS and SSH
servers~\cite{Heninger2012a}; nation-wide databases~\cite{Bernstein2013a}; as
well as POP3S, IMAPS, and SMTPS servers~\cite{Hastings2016a}.  In this work, we
study the Tor network.

Relays with weak cryptographic keys can pose a significant threat to Tor users.
The exact impact depends on the type of key that is vulnerable.  In the best
case, an attacker only manages to compromise the TLS layer that protects Tor
cells, which are also encrypted.  In the worst case, an attacker compromises a
relay's long-term ``identity key,'' which equates to taking ownership of the relay.
Therefore, we need methods to quickly find vulnerable relays and remove them
from the network before adversaries can exploit them.

Drawing on a publicly-archived dataset of 3.7 million RSA public
keys~\cite{collector}, we set out to analyze these keys for weaknesses and
anomalies: shared prime factors, shared moduli, and non-standard RSA exponents.
To our surprise, we found more than 3,000 keys with shared prime factors, most
belonging to a research project from 2013~\cite{Biryukov2013a}.  Ten relays in
our dataset shared a modulus, suggesting manual interference with the key
generation process.  Finally, we discovered 122 relays whose RSA exponent
differed from Tor's hard-coded exponent.  We believe that most of these relays
were meant to manipulate Tor's distributed hash table (DHT), presumably in an
attempt to attack onion services.  To learn more, we implemented a tool that
simulates how onion services are placed on the DHT, revealing three onion
services that were likely targeted.  As diverse as the incidents we uncovered
are the entities behind them; researchers, developers, and actual adversaries
were all involved in key anomalies.

By looking for information that is shared across relays such as similar
nicknames, IP address blocks, uptimes, and port numbers, we could group the
relays we discovered into clusters that are likely operated by the same
entities.  We publish all our source code, allowing third parties such as The
Tor Project to set up systems to continuously check the keys of new relays, and
alert developers if any of these keys are vulnerable or non-standard.  Tor
developers can then take early action and remove these relays from the network
before adversaries get the chance to take advantage of them.  In summary, we
make the following two key contributions.
\begin{itemize}
	\item We analyze a dataset consisting of 3.7 million RSA public keys for
		weak and non-standard keys, revealing thousands of affected keys.

	\item We characterize the relays we discovered and show that many were
		likely operated by a single entity.
\end{itemize}

The rest of this paper details our project.  In Section~\ref{sec:background}, we
provide background information, followed by Section~\ref{sec:related} where we 
discuss related work.  In Section~\ref{sec:method} we describe our method,
and in Section~\ref{sec:results} we present our results.  We discuss our work in
Section~\ref{sec:discussion} and conclude in Section~\ref{sec:conclusion}.
